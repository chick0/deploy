# Deploy

프론트 엔드 프로젝트의 배포를 쉽게 하기 위해서 만든 프로젝트입니다.

## 구현된 기능

1. 계정
    - 유저 ID가 1인 유저는 관리자 유저입니다.
    - 사용자는 `useradd.py` 스크립트를 사용해 추가할 수 있습니다.
        - 또는 사이트의 계정 > 계정 등록 메뉴에서 추가 할 수 있습니다. (해당 기능은 관리자 유저만 사용할 수 있습니다.)
    - 등록된 유저의 비밀번호는 임시 비밀번호로 설정되며, 임시 비밀번호로 로그인시 변경할 수 있습니다. 
    - 본인의 대시보드에서 로그인 날짜, 비밀번호 변경날짜, 사용량을 확인할 수 있습니다.
    - 추가로 관리자는 계정 > 계정 목록 화면에서 사용자를 삭제하거나 비밀번호를 임시 비밀번호로 재설정 할 수 있습니다. 
2. 프로젝트
    - 유저당 생성할 수 있는 프로젝트의 개수에는 제한이 있습니다.
        - 해당 제한은 `app/__init__.py` 에서 수정할 수 있습니다.
    - 프로젝트의 이름은 중복될 수 없으며, 영어 소문자와 일부 특수기호를 사용할 수 있습니다.
    - 프로젝트 생성은 사이트의 프로젝트 > 프로젝트 생성 화면에서 추가할 수 있습니다.
    - 본인의 프로젝트만 조회할 수 있습니다.
        - 관리자 유저의 경우에는 다른 유저의 프로젝트도 조회할 수 있습니다.
3. 배포 토큰
    - 배포 토큰의 생성에는 제한이 없습니다.
    - 토큰을 생성할 때 토큰의 만료일을 설정할 수 있습니다.
4. 배포
    - 프로젝트의 이름과, 배포 토큰을 이용해 요청을 검증합니다.
    - zip 파일만 업로드 할 수 있습니다. (매직 넘버를 활용해 확인합니다.)
5. 배포 버전
    - 유저당 생성할 수 있는 배포 버전의 개수에는 제한이 있습니다.
    - 프로젝트 > 프로젝트 목록 화면에서 배포 버전 보기에서 확인할 수 있습니다.
    - 업로드된 파일의 용량과 압축 파일에 포함된 파일 목록을 확인할 수 있습니다.
    - 또 해당 버전을 삭제하거나 적용할 수 있습니다.

## 배포 사용 예시

단순하게 파일 업로드 기능만 구현되어있는 [cli.py](https://gist.github.com/chick0/8b5f5f32e652210e98d8941df075d949)를 사용하는 예시는 [example.yaml](https://github.com/chick0/deploy/blob/master/example.yaml)를 참고해주세요.

## 작동 방식

1. 프로젝트를 생성합니다.

2. 해당 프로젝트에서 배포할 때 사용할 배포 토큰을 만듭니다.

3. 배포 업로드 API로 프로젝트의 이름과 배포 토큰 그리고 빌드된 프론트를 압축 파일 형태로 업로드 합니다.

4. 업로드된 파일의 압축을 임시 풀더(프로젝트의 unzip 풀더) 해제합니다.

5. 압축이 해제된 파일은 프로젝트 파일 경로로 이동시킵니다. (이때 기존에 있던 파일은 삭제합니다.)
